<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TilePerfect [ALPHA]</title>
  </head>
  <body>
    <!-- ==================== HEADER ==================== -->
    <header class="topbar">
      <div class="topbar-left">
        <img src="/logo.svg" alt="TilePerfect Logo" class="logo" />
        <div class="topbar-title">
          <div class="title" data-i18n="app.title">TilePerfect [ALPHA]</div>
        </div>
      </div>
      <div class="topbar-right">
        <div class="undo-controls">
          <button id="btnUndo" class="btn-icon" title="Undo (Ctrl+Z)" data-i18n-title="undo.undo">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 7v6h6"/>
              <path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"/>
            </svg>
          </button>
          <button id="btnRedo" class="btn-icon" title="Redo (Ctrl+Y)" data-i18n-title="undo.redo">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 7v6h-6"/>
              <path d="M3 17a9 9 0 019-9 9 9 0 016 2.3l3 2.7"/>
            </svg>
          </button>
          <span class="undo-counter" id="undoCounter">0 / 0</span>
        </div>
        <div class="lang-picker">
          <select id="langSelect">
            <option value="de" data-i18n="language.german">Deutsch</option>
            <option value="en" data-i18n="language.english">English</option>
          </select>
        </div>
        <div class="autosave-indicator">
          <span class="dot"></span>
          <span data-i18n="app.autosave">Autosave</span>
        </div>
        <div class="settings-menu">
          <button id="btnSettingsToggle" class="btn-icon" title="Settings">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </button>
          <div id="settingsDropdown" class="settings-dropdown hidden">
            <div class="settings-section">
              <button id="menuSaveProject" class="settings-item">
                <span class="settings-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                    <polyline points="7 3 7 8 15 8"></polyline>
                  </svg>
                </span>
                <span data-i18n="settings.save">Save Project</span>
              </button>
              <button id="menuLoadProject" class="settings-item">
                <span class="settings-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 7h5l2 2h11v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <path d="M3 7V5a2 2 0 0 1 2-2h4l2 2"></path>
                  </svg>
                </span>
                <span data-i18n="settings.load">Load Project</span>
              </button>
            </div>
            <div class="settings-divider"></div>
            <div class="settings-section">
              <button id="menuExport" class="settings-item">
                <span class="settings-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 3h7v7"></path>
                    <path d="M10 14L21 3"></path>
                    <path d="M21 14v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h7"></path>
                  </svg>
                </span>
                <span data-i18n="settings.export">Export JSON</span>
              </button>
              <button id="menuImport" class="settings-item">
                <span class="settings-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                </span>
                <span data-i18n="settings.import">Import JSON</span>
              </button>
            </div>
            <div class="settings-divider"></div>
            <div class="settings-section">
              <button id="menuDebug" class="settings-item">
                <span class="settings-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 9a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"></path>
                    <path d="M19 12a7 7 0 0 0-14 0"></path>
                    <path d="M5 12v2"></path>
                    <path d="M19 12v2"></path>
                    <path d="M12 2v3"></path>
                    <path d="M3 12H2"></path>
                    <path d="M22 12h-1"></path>
                  </svg>
                </span>
                <span data-i18n="settings.debug">Debug Panel</span>
              </button>
              <button id="menuReset" class="settings-item danger">
                <span class="settings-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 2v6h-6"></path>
                    <path d="M3 12a9 9 0 0 1 15-6l3 2"></path>
                    <path d="M3 22v-6h6"></path>
                    <path d="M21 12a9 9 0 0 1-15 6l-3-2"></path>
                  </svg>
                </span>
                <span data-i18n="settings.reset">Reset All</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- ==================== MAIN NAVIGATION ==================== -->
    <nav class="main-nav">
      <div class="main-nav-tabs">
        <button class="main-nav-tab active" data-main-tab="setup">
          <span class="main-nav-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 10.5l9-7 9 7"></path>
              <path d="M5 9.5V21h14V9.5"></path>
              <path d="M9 21v-6h6v6"></path>
            </svg>
          </span>
          <span data-i18n="nav.setup">Setup</span>
        </button>
        <button class="main-nav-tab" data-main-tab="planning">
          <span class="main-nav-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="6" width="18" height="12" rx="2"></rect>
              <line x1="7" y1="6" x2="7" y2="10"></line>
              <line x1="11" y1="6" x2="11" y2="12"></line>
              <line x1="15" y1="6" x2="15" y2="10"></line>
              <line x1="19" y1="6" x2="19" y2="12"></line>
            </svg>
          </span>
          <span data-i18n="nav.planning">Planning</span>
        </button>
        <button class="main-nav-tab" data-main-tab="commercial">
          <span class="main-nav-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 1v22"></path>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
          </span>
          <span data-i18n="nav.commercial">Commercial</span>
        </button>
        <button class="main-nav-tab" data-main-tab="export">
          <span class="main-nav-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 3v12"></path>
              <path d="M8 11l4 4 4-4"></path>
              <path d="M4 17h16v4H4z"></path>
            </svg>
          </span>
          <span data-i18n="export.tab">Export</span>
        </button>
      </div>
      <div class="main-nav-context">
        <span id="navContextInfo" class="nav-context-text"></span>
      </div>
      <div class="main-nav-actions">
        <div id="warningsWrapper" class="planning-warnings-mini">
          <span class="warn-icon" aria-hidden="true">!</span>
          <span class="pill" id="warnPill">0</span>
        </div>
        <div id="tipsWrapper" class="planning-warnings-mini planning-tips-mini hidden">
          <span class="warn-icon" aria-hidden="true">i</span>
          <span class="pill" id="tipsPill">0</span>
        </div>
      </div>
    </nav>

    <!-- ==================== MAIN CONTENT ==================== -->
    <main class="main-content">

      <!-- ========== SETUP TAB ========== -->
      <section class="main-panel active" data-main-panel="setup">
        <div class="setup-flow">
          <!-- Project Section -->
          <div class="setup-block">
            <div class="setup-block-header">
              <span class="setup-block-number">1</span>
              <h3 class="setup-block-title" data-i18n="setup.projectTitle">Project</h3>
            </div>
            <div class="setup-block-content">
              <div class="field">
                <label data-i18n="setup.projectOpenExistingTitle">Open Existing Project</label>
                <div class="inline-select-row">
                  <select id="projectSelect" class="inline-select"></select>
                  <button id="btnDeleteProject" class="btn-inline danger" title="Delete Project" aria-label="Delete Project">×</button>
                </div>
              </div>
              <div id="projectDeleteWarning" class="warnItem preset-delete-warning hidden">
                <div class="wTitle" data-i18n="project.deleteConfirmTitle">Delete project?</div>
                <div class="wText" data-i18n="project.deleteConfirmText">This will remove the saved project from this browser.</div>
                <div class="preset-delete-actions">
                  <button id="btnConfirmDeleteProject" class="btn small tile-edit-btn discard" data-i18n="project.deleteConfirm">Delete project</button>
                  <button id="btnCancelDeleteProject" class="btn ghost small tile-edit-btn" data-i18n="project.deleteCancel">Cancel</button>
                </div>
              </div>
              <div class="field">
                <label data-i18n="setup.projectSaveNewTitle">Save New Project</label>
                <div class="inline-select-row">
                  <input id="projectName" type="text" data-i18n-placeholder="project.namePlaceholder" placeholder="e.g. Bathroom Ground Floor" />
                  <button id="btnSaveProject" class="btn-inline" title="Save Project" aria-label="Save Project">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16" aria-hidden="true">
                      <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                      <polyline points="17 21 17 13 7 13 7 21"></polyline>
                      <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                  </button>
                </div>
              </div>
              <label class="toggle-switch">
                <span class="toggle-label" data-i18n="waste.shareOffcuts">Share offcuts across rooms</span>
                <input id="wasteShareOffcuts" type="checkbox" />
                <div class="toggle-slider"></div>
              </label>
            </div>
          </div>

          <!-- Tile Collection -->
          <div class="setup-block">
            <div class="setup-block-header">
              <span class="setup-block-number">2</span>
              <h3 class="setup-block-title" data-i18n="setup.tileCollection">Tile Collection</h3>
            </div>
            <div class="setup-block-content">
              <div class="setup-collection">
                <div class="collection-section">
                  <h4 class="collection-title" data-i18n="setup.tilePresets">Tile Presets</h4>
                  <div class="inline-select-row">
                    <select id="tilePresetList" class="inline-select"></select>
                    <button id="btnAddTilePreset" class="btn-inline" title="Add Preset">+</button>
                    <button id="btnDeleteTilePreset" class="btn-inline danger" title="Delete Preset">×</button>
                  </div>
                  <div id="tilePresetDeleteWarning" class="warnItem preset-delete-warning hidden">
                    <div class="wTitle" data-i18n="setup.presetDeleteInUseTitle">Preset in use</div>
                    <div class="wText" id="tilePresetDeleteWarningText"></div>
                    <div class="preset-delete-actions">
                      <button id="btnConfirmDeleteTilePreset" class="btn small tile-edit-btn discard" data-i18n="setup.presetDeleteConfirm">Delete preset</button>
                      <button id="btnCancelDeleteTilePreset" class="btn ghost small tile-edit-btn" data-i18n="setup.presetDeleteCancel">Cancel</button>
                    </div>
                  </div>
                  <div class="field">
                    <label data-i18n="setup.presetName">Name</label>
                    <input id="tilePresetName" type="text" />
                  </div>
                  <div class="field">
                    <label data-i18n="tile.shape">Tile Shape</label>
                    <select id="tilePresetShape">
                      <option value="rect" data-i18n="tile.shapeRect">Rectangular</option>
                      <option value="square" data-i18n="tile.shapeSquare">Square</option>
                      <option value="hex" data-i18n="tile.shapeHex">Hexagonal</option>
                      <option value="rhombus" data-i18n="tile.shapeRhombus">Rhombus</option>
                    </select>
                  </div>
                  <div class="field-row">
                    <div class="field">
                      <label data-i18n="tile.width">Width (cm)</label>
                      <input id="tilePresetW" type="number" min="0" step="0.1" />
                    </div>
                    <div class="field">
                      <label data-i18n="tile.height">Length (cm)</label>
                      <input id="tilePresetH" type="number" min="0" step="0.1" />
                    </div>
                  </div>
                  <div class="field-row">
                    <div class="field">
                      <label data-i18n="tile.grout">Grout</label>
                      <div class="input-with-unit">
                        <div class="quick-spinner">
                          <button type="button" class="quick-spinner-btn" data-action="decrement" data-target="tilePresetGroutW">−</button>
                          <input id="tilePresetGroutW" type="number" class="quick-input small no-spinner" min="0" step="1" />
                          <button type="button" class="quick-spinner-btn" data-action="increment" data-target="tilePresetGroutW">+</button>
                        </div>
                        <span class="input-unit">mm</span>
                      </div>
                    </div>
                    <div class="field">
                      <label data-i18n="tile.groutColor">Color</label>
                      <div class="color-picker-row">
                        <div class="color-presets" id="tilePresetGroutColorPresets">
                          <button type="button" class="color-swatch" data-color="#ffffff" style="background:#ffffff" title="White"></button>
                          <button type="button" class="color-swatch" data-color="#cccccc" style="background:#cccccc" title="Light Grey"></button>
                          <button type="button" class="color-swatch" data-color="#808080" style="background:#808080" title="Grey"></button>
                          <button type="button" class="color-swatch" data-color="#404040" style="background:#404040" title="Dark Grey"></button>
                          <button type="button" class="color-swatch" data-color="#000000" style="background:#000000" title="Black"></button>
                        </div>
                        <input id="tilePresetGroutColor" type="color" value="#ffffff" />
                      </div>
                    </div>
                  </div>
                  <div class="field-row">
                    <div class="field">
                      <label data-i18n="pricing.pricePerM2">Price per m² (€)</label>
                      <input id="tilePresetPricePerM2" type="number" min="0" step="0.01" />
                    </div>
                    <div class="field">
                      <label data-i18n="pricing.packSize">Pack size (m²)</label>
                      <input id="tilePresetPackM2" type="number" min="0" step="0.01" />
                    </div>
                  </div>
                  <div class="field">
                    <label data-i18n="pricing.pricePerPack">Price per pack (€)</label>
                    <input id="tilePresetPricePerPack" type="number" min="0" step="0.01" />
                  </div>
                  <div class="field">
                    <label data-i18n="setup.assignRooms">Assign to rooms</label>
                    <div id="tilePresetRoomList" class="preset-room-list"></div>
                  </div>
                  <label class="toggle-switch">
                    <span class="toggle-label" data-i18n="setup.useForSkirting">Use as skirting (cutout)</span>
                    <input id="tilePresetUseSkirting" type="checkbox" />
                    <div class="toggle-slider"></div>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Skirting Section -->
          <div class="setup-block">
            <div class="setup-block-header">
              <span class="setup-block-number">3</span>
              <h3 class="setup-block-title" data-i18n="setup.skirtingTitle">Skirting</h3>
            </div>
            <div class="setup-block-content">
              <div class="setup-collection">
                <div class="collection-section">
                  <h4 class="collection-title" data-i18n="setup.skirtingPresets">Skirting Presets</h4>
                  <div class="inline-select-row">
                    <select id="skirtingPresetList" class="inline-select"></select>
                    <button id="btnAddSkirtingPreset" class="btn-inline" title="Add Preset">+</button>
                    <button id="btnDeleteSkirtingPreset" class="btn-inline danger" title="Delete Preset">×</button>
                  </div>
                  <div class="field">
                    <label data-i18n="setup.presetName">Name</label>
                    <input id="skirtingPresetName" type="text" />
                  </div>
                  <div class="field-row">
                    <div class="field">
                      <label data-i18n="skirting.height">Height (cm)</label>
                      <input id="skirtingPresetHeight" type="number" min="0" step="0.1" />
                    </div>
                    <div class="field">
                      <label data-i18n="skirting.boughtWidth">Length/piece (cm)</label>
                      <input id="skirtingPresetLength" type="number" min="0" step="0.1" />
                    </div>
                  </div>
                  <div class="field">
                    <label data-i18n="skirting.pricePerPiece">Price/piece (€)</label>
                    <input id="skirtingPresetPrice" type="number" min="0" step="0.01" />
                  </div>
                </div>
                <div class="collection-section">
                  <h4 class="collection-title" data-i18n="setup.skirtingPerRoom">Per Room</h4>
                  <div id="skirtingRoomsList" class="skirting-room-list">
                    <div class="meta subtle" data-i18n="project.none">– none –</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Continue Button -->
          <div class="setup-continue">
            <button id="btnContinuePlanning" class="btn primary large">
              <span data-i18n="setup.continuePlanning">Continue to Planning</span>
              <span class="btn-arrow">→</span>
            </button>
          </div>
        </div>

        <!-- Hidden elements for compatibility -->
        <input id="fileImport" type="file" accept="application/json" style="display: none;" />
        <span id="sessionStatus" style="display: none;"></span>
        <span id="lastSaved" style="display: none;"></span>
      </section>

      <!-- ========== PLANNING TAB ========== -->
      <section class="main-panel" data-main-panel="planning">
        <div class="planning-fullwidth">
          <!-- Planning Header -->
          <div class="planning-header">
            <div class="planning-header-left">
              <!-- View Toggle -->
              <div class="view-toggle">
                <button id="floorViewBtn" class="view-toggle-btn" title="Floor View">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                  </svg>
                  <span data-i18n="planning.floorView">Floor</span>
                </button>
                <button id="patternGroupsViewBtn" class="view-toggle-btn" title="Pattern Groups">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="10" height="10" rx="1"></rect>
                    <rect x="11" y="11" width="10" height="10" rx="1"></rect>
                  </svg>
                  <span data-i18n="planning.patternGroups">Groups</span>
                </button>
                <button id="roomViewBtn" class="view-toggle-btn active" title="Room View">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                  </svg>
                  <span data-i18n="planning.roomView">Room</span>
                </button>
              </div>
              <div class="view-toggle-divider"></div>
              <label class="planning-room-select">
                <span data-i18n="tabs.floor">Floor:</span>
                <select id="planningFloorSelect"></select>
              </label>
              <label class="planning-room-select" id="roomSelectLabel">
                <span data-i18n="tabs.room">Room:</span>
                <select id="planningRoomSelect"></select>
              </label>
              <label class="planning-room-select" id="groupSelectLabel" style="display: none;">
                <span data-i18n="patternGroups.selectedGroup">Selected Group:</span>
                <select id="pgGroupSelect"></select>
              </label>
            </div>
            <div class="planning-header-right">
              <button id="btnFullscreen" class="btn-icon" title="Fullscreen">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
                </svg>
              </button>
            </div>
          </div>

          <!-- SVG Preview Area -->
          <div class="planning-preview-area">
            <div class="svgWrap planning-svg">
              <svg id="planSvg" xmlns="http://www.w3.org/2000/svg"></svg>
              <div id="resizeMetrics" class="resize-metrics hidden"></div>

              <!-- Scale indicator for calibrated floor view -->
              <div id="floorScaleIndicator" class="floor-scale-indicator hidden">
                <div class="scale-bar"></div>
                <span id="floorScaleText">1 cm = 1 px</span>
              </div>

              <!-- Floor View Quick Controls (hidden by default) -->
              <div class="quick-controls floor-controls" id="floorQuickControls" style="display: none;">
                <!-- Floor Management -->
                <div class="quick-control-group">
                  <span class="quick-label" data-i18n="tabs.floor">Floor:</span>
                  <select id="floorQuickSelect" class="quick-select"></select>
                  <input type="text" id="floorQuickName" class="quick-input" style="width: 100px;" placeholder="Name">
                </div>
                <div class="quick-actions">
                  <button id="floorQuickAddFloor" class="quick-btn" title="Add floor">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                      <line x1="12" y1="10" x2="12" y2="18"></line>
                      <line x1="8" y1="14" x2="16" y2="14"></line>
                    </svg>
                  </button>
                  <button id="floorQuickDeleteFloor" class="quick-btn danger" title="Delete floor">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="m19 6-.867 12.142A2 2 0 0 1 16.138 20H7.862a2 2 0 0 1-1.995-1.858L5 6m5 0V4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2"></path>
                    </svg>
                  </button>
                </div>
                <div class="quick-control-divider"></div>
                <!-- Room Actions -->
                <div class="quick-actions">
                  <button id="floorAddRoom" class="quick-btn" title="Add rectangle room">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                      <line x1="12" y1="8" x2="12" y2="16"></line>
                      <line x1="8" y1="12" x2="16" y2="12"></line>
                    </svg>
                  </button>
                  <button id="floorDrawRoom" class="quick-btn" title="Draw freeform room">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 2 L22 8.5 L22 15.5 L12 22 L2 15.5 L2 8.5 Z"></path>
                      <line x1="12" y1="9" x2="12" y2="15"></line>
                      <line x1="9" y1="12" x2="15" y2="12"></line>
                    </svg>
                  </button>
                  <button id="floorDeleteRoom" class="quick-btn danger" title="Delete selected room" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="m19 6-.867 12.142A2 2 0 0 1 16.138 20H7.862a2 2 0 0 1-1.995-1.858L5 6m5 0V4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2"></path>
                    </svg>
                  </button>
                </div>
                <div class="quick-control-divider"></div>
                <!-- Background Controls -->
                <div class="quick-control-group">
                  <input type="file" id="bgUpload" accept="image/*,.pdf" class="hidden-input" style="display: none;">
                  <button id="bgUploadBtn" class="quick-btn" title="Upload background image">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                      <circle cx="8.5" cy="8.5" r="1.5"></circle>
                      <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                  </button>
                  <button id="bgCalibrateBtn" class="quick-btn" title="Calibrate scale" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M2 12h4m12 0h4M12 2v4m0 12v4"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                  </button>
                </div>
                <div class="quick-control-group">
                  <span class="quick-label" data-i18n="floor.opacity">Opacity:</span>
                  <input type="range" id="bgOpacitySlider" class="quick-slider" min="0" max="100" value="50" disabled>
                </div>
                <div class="quick-control-divider"></div>
                <!-- Quick Toggles -->
                <div class="quick-toggles">
                  <label class="quick-toggle" title="Show Grid">
                    <input id="floorShowGrid" type="checkbox" />
                    <span class="quick-toggle-icon">▦</span>
                  </label>
                  <label class="quick-toggle" title="Show Tiles (disables room editing)">
                    <input id="floorShowTiles" type="checkbox" />
                    <span class="quick-toggle-icon">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="8" height="8"></rect>
                        <rect x="13" y="3" width="8" height="8"></rect>
                        <rect x="3" y="13" width="8" height="8"></rect>
                        <rect x="13" y="13" width="8" height="8"></rect>
                      </svg>
                    </span>
                  </label>
                </div>
                <div class="quick-control-divider"></div>
                <!-- Zoom Controls (at end, like room view) -->
                <div class="zoom-controls">
                  <button id="floorZoomOut" class="quick-btn zoom-btn" title="Zoom Out (-)">−</button>
                  <span id="floorZoomLevel" class="zoom-indicator">100%</span>
                  <button id="floorZoomIn" class="quick-btn zoom-btn" title="Zoom In (+)">+</button>
                  <button id="floorZoomReset" class="quick-btn zoom-btn" title="Reset Zoom (0)">⊙</button>
                </div>
              </div>

              <!-- Calibration Panel (shown during calibration) -->
              <div id="calibrationPanel" class="calibration-panel hidden">
                <div class="calibration-header">
                  <span class="calibration-step" id="calibrationStep" data-i18n="floor.calibrateStep">Step 1/3</span>
                  <button id="btnCancelCalibration" class="btn-icon small" title="Cancel">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="18" y1="6" x2="6" y2="18"></line>
                      <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                  </button>
                </div>
                <p class="calibration-instruction" id="calibrationInstruction" data-i18n="floor.calibrateDrawLine">Click two points on a known measurement</p>
                <div class="calibration-input hidden" id="calibrationInputSection">
                  <label for="calibrationLengthInput" data-i18n="floor.calibrateEnterLength">Enter length (cm):</label>
                  <div class="calibration-input-row">
                    <input type="number" id="calibrationLengthInput" min="0.1" step="0.1" placeholder="100" />
                    <button id="btnConfirmCalibrationLength" class="btn small primary" data-i18n="floor.calibrateConfirm">Confirm</button>
                  </div>
                </div>
                <div class="calibration-measurements" id="calibrationMeasurements"></div>
                <div class="calibration-success hidden" id="calibrationSuccess">
                  <div class="calibration-success-icon">✓</div>
                  <p data-i18n="floor.calibrateComplete">Calibration complete!</p>
                  <p class="calibration-scale" id="calibrationScaleResult"></p>
                  <button id="btnCloseCalibration" class="btn small primary" data-i18n="floor.calibrateDone">Done</button>
                </div>
              </div>

              <!-- Pattern Groups View Quick Controls (hidden by default) -->
              <div class="quick-controls pattern-groups-controls" id="patternGroupsQuickControls" style="display: none;">
                <!-- Group Actions -->
                <div class="quick-actions">
                  <button id="pgCreateGroup" class="quick-btn" title="Create pattern group from selected room" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="3" width="10" height="10" rx="1"></rect>
                      <rect x="11" y="11" width="10" height="10" rx="1"></rect>
                    </svg>
                  </button>
                  <button id="pgAddToGroup" class="quick-btn" title="Add selected room to group" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="12" y1="8" x2="12" y2="16"></line>
                      <line x1="8" y1="12" x2="16" y2="12"></line>
                    </svg>
                  </button>
                  <button id="pgRemoveFromGroup" class="quick-btn" title="Remove selected room from group" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="8" y1="12" x2="16" y2="12"></line>
                    </svg>
                  </button>
                  <button id="pgSetOrigin" class="quick-btn" title="Set selected room as origin" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                  </button>
                  <button id="pgDissolveGroup" class="quick-btn danger" title="Dissolve pattern group" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="m19 6-.867 12.142A2 2 0 0 1 16.138 20H7.862a2 2 0 0 1-1.995-1.858L5 6m5 0V4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2"></path>
                    </svg>
                  </button>
                </div>
                <div class="quick-control-divider"></div>
                <!-- Quick Toggles -->
                <div class="quick-toggles">
                  <label class="quick-toggle" title="Show Grid">
                    <input id="pgShowGrid" type="checkbox" />
                    <span class="quick-toggle-icon">▦</span>
                  </label>
                </div>
                <div class="quick-control-divider"></div>
                <!-- Zoom Controls -->
                <div class="zoom-controls">
                  <button id="pgZoomOut" class="quick-btn zoom-btn" title="Zoom Out (-)">−</button>
                  <span id="pgZoomLevel" class="zoom-indicator">100%</span>
                  <button id="pgZoomIn" class="quick-btn zoom-btn" title="Zoom In (+)">+</button>
                  <button id="pgZoomReset" class="quick-btn zoom-btn" title="Reset Zoom (0)">⊙</button>
                </div>
              </div>

              <!-- Room View Quick Controls Bar (floating) -->
              <div class="quick-controls room-controls" id="roomQuickControls">
                <div class="quick-control-group" id="quickTilePresetGroup">
                  <span class="quick-label" data-i18n="planning.tile">Tile:</span>
                  <select id="quickTilePreset" class="quick-select quick-select-wide"></select>
                  <button id="quickCreateTilePreset" class="btn small hidden quick-create-preset" data-i18n="tile.createPreset">Create preset</button>
                </div>
                <div class="quick-control-group">
                  <span class="quick-label" data-i18n="tile.pattern">Pattern:</span>
                  <select id="quickPattern" class="quick-select">
                    <option value="grid">Grid</option>
                    <option value="runningBond">Running Bond</option>
                    <option value="herringbone">Herringbone</option>
                    <option value="doubleHerringbone">Double Herringbone</option>
                    <option value="basketweave">Basketweave</option>
                  </select>
                </div>
                <div class="quick-control-group">
                  <span class="quick-label" data-i18n="tile.grout">Grout:</span>
                  <div class="quick-spinner">
                    <button type="button" class="quick-spinner-btn" data-action="decrement" data-target="quickGrout">−</button>
                    <input id="quickGrout" type="number" class="quick-input small no-spinner" min="0" step="1" />
                    <button type="button" class="quick-spinner-btn" data-action="increment" data-target="quickGrout">+</button>
                  </div>
                  <span class="quick-unit">mm</span>
                </div>
                <div class="quick-control-divider"></div>
                <div class="quick-toggles">
                  <label class="quick-toggle" title="Show Grid">
                    <input id="quickShowGrid" type="checkbox" />
                    <span class="quick-toggle-icon">▦</span>
                  </label>
                  <label class="quick-toggle" title="Show Skirting">
                    <input id="quickShowSkirting" type="checkbox" />
                    <span class="quick-toggle-icon">▭</span>
                  </label>
                  <label class="quick-toggle" title="Removal Mode">
                    <input id="quickRemovalMode" type="checkbox" />
                    <span class="quick-toggle-icon">✂</span>
                  </label>
                </div>
                <div class="quick-control-divider"></div>
                <div class="quick-actions">
                  <div class="quick-dropdown">
                    <button id="quickAddExclusion" class="quick-btn" title="Add Exclusion">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                        <line x1="12" y1="8" x2="12" y2="16"></line>
                        <line x1="8" y1="12" x2="16" y2="12"></line>
                      </svg>
                    </button>
                    <div id="exclDropdown" class="quick-dropdown-menu hidden">
                      <button class="quick-dropdown-item" data-excl-type="rect">
                        <span class="quick-dropdown-icon">▭</span>
                        <span>Rectangle</span>
                      </button>
                      <button class="quick-dropdown-item" data-excl-type="circle">
                        <span class="quick-dropdown-icon">○</span>
                        <span>Circle</span>
                      </button>
                      <button class="quick-dropdown-item" data-excl-type="triangle">
                        <span class="quick-dropdown-icon">△</span>
                        <span>Triangle</span>
                      </button>
                    </div>
                  </div>
                  <button id="roomDeleteObject" class="quick-btn danger" title="Delete selected" data-i18n-title="planning.deleteSelected" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                  </button>
                </div>
                <div class="quick-control-divider"></div>
                <div class="quick-actions">
                  <button id="quickOpenSettings" class="quick-btn" title="Settings">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="3"></circle>
                      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                  </button>
                </div>
                <div class="quick-control-divider"></div>
                <div class="zoom-controls">
                  <button id="zoomOut" class="quick-btn zoom-btn" title="Zoom Out (-)">−</button>
                  <span id="zoomLevel" class="zoom-indicator">100%</span>
                  <button id="zoomIn" class="quick-btn zoom-btn" title="Zoom In (+)">+</button>
                  <button id="zoomReset" class="quick-btn zoom-btn" title="Reset Zoom (0)">⊙</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Metrics Bar -->
          <div class="metrics-bar" id="metrics">
            <div class="metrics-bar-item">
              <span class="metrics-bar-label" data-i18n="metrics.netArea">Area:</span>
              <span class="metrics-bar-value" id="metricArea">–</span>
            </div>
            <div class="metrics-bar-divider"></div>
            <div class="metrics-bar-item">
              <span class="metrics-bar-label" data-i18n="metrics.totalTiles">Tiles:</span>
              <span class="metrics-bar-value" id="metricTiles">–</span>
              <span class="metrics-bar-sub">(<span id="metricCutTiles">–</span> cut)</span>
            </div>
            <div class="metrics-bar-divider"></div>
            <div class="metrics-bar-item">
              <span class="metrics-bar-label" data-i18n="metrics.tilePacks">Packs:</span>
              <span class="metrics-bar-value" id="metricPacks">–</span>
            </div>
            <div class="metrics-bar-divider"></div>
            <div class="metrics-bar-item highlight">
              <span class="metrics-bar-label" data-i18n="metrics.price">Cost:</span>
              <span class="metrics-bar-value" id="metricCost">–</span>
            </div>
            <div class="metrics-bar-divider"></div>
            <div class="metrics-bar-item">
              <span class="metrics-bar-label" data-i18n="metrics.waste">Waste:</span>
              <span class="metrics-bar-value" id="metricWaste">–</span>
            </div>
          </div>
        </div>

        <!-- Slide-out Settings Panel -->
        <div id="settingsPanel" class="settings-panel hidden">
          <div class="settings-panel-header">
            <h3 data-i18n="planning.settings">Settings</h3>
            <button id="btnCloseSettings" class="btn-icon small">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <div class="settings-panel-content">
            <!-- Tile Settings -->
            <div class="panel-section" id="planningTileSection">
              <h4 class="panel-section-title" data-i18n="tile.sectionTiles">Tiles</h4>
              <div class="panel-fields">
                <div class="field-row" id="tilePresetRow">
                  <div class="field">
                    <label data-i18n="tile.preset">Preset</label>
                    <select id="tilePresetSelect"></select>
                  </div>
                </div>
                <div id="tilePresetEmptyRow" class="tile-preset-empty hidden">
                  <div class="tile-preset-empty-text" data-i18n="tile.presetEmptyHint">Create your first tile preset to start planning.</div>
                  <button id="btnCreateTilePreset" class="btn small" data-i18n="tile.createPreset">Create preset</button>
                </div>
                <label class="toggle-switch">
                  <span class="toggle-label" data-i18n="planning.editTileConfig">Edit</span>
                  <input id="tileConfigEditToggle" type="checkbox" />
                  <div class="toggle-slider"></div>
                </label>
                <div class="tile-config-fields">
                <div class="field" id="tileReferenceField">
                  <label data-i18n="tile.reference">Reference / Name</label>
                  <input id="tileReference" type="text" list="tileReferences" placeholder="e.g. Marble Carrara" />
                  <datalist id="tileReferences"></datalist>
                  <div id="tileEditError" class="field-error hidden"></div>
                </div>
                <div class="field">
                  <label data-i18n="tile.shape">Tile Shape</label>
                  <select id="tileShape">
                    <option value="rect" data-i18n="tile.shapeRect">Rectangular</option>
                    <option value="square" data-i18n="tile.shapeSquare">Square</option>
                    <option value="hex" data-i18n="tile.shapeHex">Hexagonal</option>
                    <option value="rhombus" data-i18n="tile.shapeRhombus">Rhombus</option>
                  </select>
                </div>
                <div class="field-row">
                  <div class="field">
                    <label data-i18n="tile.width">Width (cm)</label>
                    <input id="tileW" type="number" min="0" step="0.1" />
                  </div>
                  <div class="field" id="tileHeightField">
                    <label data-i18n="tile.height">Length (cm)</label>
                    <input id="tileH" type="number" min="0" step="0.1" />
                  </div>
                </div>
                <div class="meta subtle" id="hexHint" style="display: none;">
                  <span data-i18n="tile.hexHint">For hexagons: width = flat-to-flat. Height auto-calculated.</span>
                </div>
                <div class="field-row">
                  <div class="field">
                    <label data-i18n="pricing.pricePerM2">Price per m² (€)</label>
                    <input id="tilePricePerM2" type="number" min="0" step="0.01" />
                  </div>
                  <div class="field">
                    <label data-i18n="pricing.packSize">Pack size (m²)</label>
                    <input id="tilePackM2" type="number" min="0" step="0.01" />
                  </div>
                </div>
                <div class="field">
                  <label data-i18n="pricing.pricePerPack">Price per pack (€)</label>
                  <input id="tilePricePerPack" type="number" min="0" step="0.01" disabled />
                </div>
                <label class="toggle-switch">
                  <span class="toggle-label" data-i18n="setup.useForSkirting">Use as skirting (cutout)</span>
                  <input id="tileAllowSkirting" type="checkbox" />
                  <div class="toggle-slider"></div>
                </label>
                </div>
                <div id="tileEditActions" class="tile-edit-actions hidden">
                  <div id="tileEditWarning" class="warnItem tile-edit-warning hidden">
                    <div class="wTitle" data-i18n="planning.tileEditUpdateWarnTitle">Affects all rooms</div>
                    <div class="wText" data-i18n="planning.tileEditUpdateWarnText">Updating this preset will update every room using it.</div>
                  </div>
                  <div class="tile-edit-actions-buttons">
                    <button id="tileEditUpdateBtn" class="btn small tile-edit-btn update" data-i18n="planning.tileEditUpdatePreset">Update preset</button>
                    <button id="tileEditSaveBtn" class="btn small tile-edit-btn new" data-i18n="planning.tileEditSaveNew">Save as new</button>
                    <button id="tileEditDiscardBtn" class="btn ghost small tile-edit-btn discard" data-i18n="planning.tileEditDiscard">Discard</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Grout Settings -->
            <div class="panel-section">
              <h4 class="panel-section-title" data-i18n="tile.sectionGrout">Grout</h4>
              <div class="panel-fields">
                <div class="field-row">
                  <div class="field">
                    <label data-i18n="tile.grout">Grout</label>
                    <div class="input-with-unit">
                      <div class="quick-spinner">
                        <button type="button" class="quick-spinner-btn" data-action="decrement" data-target="groutW">−</button>
                        <input id="groutW" type="number" class="quick-input small no-spinner" min="0" step="1" />
                        <button type="button" class="quick-spinner-btn" data-action="increment" data-target="groutW">+</button>
                      </div>
                      <span class="input-unit">mm</span>
                    </div>
                  </div>
                  <div class="field">
                    <label data-i18n="tile.groutColor">Color</label>
                    <div class="color-picker-row">
                      <div class="color-presets" id="groutColorPresets">
                        <button type="button" class="color-swatch" data-color="#ffffff" style="background:#ffffff" title="White"></button>
                        <button type="button" class="color-swatch" data-color="#cccccc" style="background:#cccccc" title="Light Grey"></button>
                        <button type="button" class="color-swatch" data-color="#808080" style="background:#808080" title="Grey"></button>
                        <button type="button" class="color-swatch" data-color="#404040" style="background:#404040" title="Dark Grey"></button>
                        <button type="button" class="color-swatch" data-color="#000000" style="background:#000000" title="Black"></button>
                      </div>
                      <input id="groutColor" type="color" value="#ffffff" />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Pattern Settings -->
            <div class="panel-section">
              <h4 class="panel-section-title" data-i18n="tile.sectionLayout">Pattern & Layout</h4>
              <div class="panel-fields">
                <div class="field-row">
                  <div class="field">
                    <label data-i18n="tile.pattern">Pattern</label>
                    <select id="patternType">
                      <option value="grid" data-i18n="tile.patternGrid">Grid</option>
                      <option value="runningBond" data-i18n="tile.patternRunningBond">Running Bond</option>
                      <option value="herringbone" data-i18n="tile.patternHerringbone">Herringbone</option>
                      <option value="doubleHerringbone" data-i18n="tile.patternDoubleHerringbone">Double Herringbone</option>
                      <option value="basketweave" data-i18n="tile.patternBasketweave">Basketweave</option>
                      <option value="verticalStackAlternating" data-i18n="tile.patternVerticalStackAlternating">Vertical Stack Alt.</option>
                    </select>
                  </div>
                  <div class="field">
                    <label data-i18n="tile.rotation">Rotation</label>
                    <select id="rotationDeg">
                      <option value="0">0°</option>
                      <option value="45">45°</option>
                      <option value="90">90°</option>
                      <option value="135">135°</option>
                      <option value="180">180°</option>
                      <option value="225">225°</option>
                      <option value="270">270°</option>
                      <option value="315">315°</option>
                    </select>
                  </div>
                </div>
                <div class="field">
                  <label data-i18n="tile.bondFraction">Bond Fraction</label>
                  <select id="bondFraction">
                    <option value="0.5">1/2</option>
                    <option value="0.3333333333">1/3</option>
                    <option value="0.25">1/4</option>
                  </select>
                </div>

                <div class="field">
                  <label data-i18n="origin.preset">Origin Preset</label>
                  <select id="originPreset">
                    <option value="tl" data-i18n="origin.presetTL">Top Left</option>
                    <option value="tr" data-i18n="origin.presetTR">Top Right</option>
                    <option value="bl" data-i18n="origin.presetBL">Bottom Left</option>
                    <option value="br" data-i18n="origin.presetBR">Bottom Right</option>
                    <option value="center" data-i18n="origin.presetCenter">Center</option>
                    <option value="free" data-i18n="origin.presetFree">Free</option>
                  </select>
                </div>
                <div class="field-row">
                  <div class="field">
                    <label data-i18n="origin.x">Origin X</label>
                    <input id="originX" type="number" step="1" />
                  </div>
                  <div class="field">
                    <label data-i18n="origin.y">Origin Y</label>
                    <input id="originY" type="number" step="1" />
                  </div>
                </div>
                <div class="field-row">
                  <div class="field">
                    <label data-i18n="tile.offsetX">Offset X</label>
                    <input id="offsetX" type="number" step="1" />
                  </div>
                  <div class="field">
                    <label data-i18n="tile.offsetY">Offset Y</label>
                    <input id="offsetY" type="number" step="1" />
                  </div>
                </div>
                <div class="btnrow">
                  <button id="btnOffLeft" class="btn small">←</button>
                  <button id="btnOffRight" class="btn small">→</button>
                  <button id="btnOffUp" class="btn small">↑</button>
                  <button id="btnOffDown" class="btn small">↓</button>
                </div>
              </div>
            </div>

            <!-- Skirting -->
            <div class="panel-section">
              <h4 class="panel-section-title" data-i18n="skirting.title">Skirting</h4>
              <div class="panel-fields">
                <label class="toggle-switch">
                  <span class="toggle-label" data-i18n="skirting.enableForRoom">Enable for this room</span>
                  <input id="planningRoomSkirtingEnabled" type="checkbox" checked />
                  <div class="toggle-slider"></div>
                </label>
                <div id="currentRoomSectionsList" class="skirting-sections-list"></div>
              </div>
            </div>

            <!-- Calculation Options -->
            <div class="panel-section">
              <h4 class="panel-section-title" data-i18n="tile.sectionPricing">Calculation</h4>
              <div class="panel-fields">
                <div class="field-row">
                  <div class="field">
                    <label data-i18n="pricing.reserve">Reserve (tiles)</label>
                    <input id="reserveTiles" type="number" step="1" min="0" />
                  </div>
                  <div class="field">
                    <label data-i18n="waste.kerfWidth">Kerf (mm)</label>
                    <input id="wasteKerfCm" type="number" min="0" step="1" value="2" />
                  </div>
                </div>
                <label class="toggle-switch">
                  <span class="toggle-label" data-i18n="waste.allowRotate">Allow offcut rotation</span>
                  <input id="wasteAllowRotate" type="checkbox" checked />
                  <div class="toggle-slider"></div>
                </label>
                <label class="toggle-switch">
                  <span class="toggle-label" data-i18n="waste.optimizeCuts">Optimize cuts</span>
                  <input id="wasteOptimizeCuts" type="checkbox" />
                  <div class="toggle-slider"></div>
                </label>
              </div>
            </div>

            <!-- Exclusions -->
            <div class="panel-section">
              <h4 class="panel-section-title" data-i18n="exclusions.title">Exclusions</h4>
              <div class="panel-fields">
                <div class="btnrow">
                  <button id="btnAddRect" class="btn small">+ Rect</button>
                  <button id="btnAddCircle" class="btn small">+ Circle</button>
                  <button id="btnAddTri" class="btn small">+ Tri</button>
                </div>
                <div class="field">
                  <select id="exclList" size="3" class="excl-list"></select>
                </div>
                <div class="btnrow">
                  <button id="btnDeleteExcl" class="btn small danger" data-i18n="exclusions.delete">Delete</button>
                </div>
                <div id="exclProps" class="excl-props">
                  <div class="meta subtle" data-i18n="exclusions.noneSelected">– none selected –</div>
                </div>
              </div>
            </div>

            <!-- Display Options -->
            <div class="panel-section">
              <h4 class="panel-section-title" data-i18n="planning.displayOptions">Display Options</h4>
              <div class="panel-fields">
                <label class="toggle-switch">
                  <span class="toggle-label" data-i18n="planning.showGrid">Show grid lines</span>
                  <input id="showGrid" type="checkbox" />
                  <div class="toggle-slider"></div>
                </label>
                <label class="toggle-switch">
                  <span class="toggle-label" data-i18n="planning.showSkirting">Show skirting</span>
                  <input id="showSkirting" type="checkbox" />
                  <div class="toggle-slider"></div>
                </label>
                <label class="toggle-switch">
                  <span class="toggle-label" data-i18n="planning.removalMode">Removal mode</span>
                  <input id="removalMode" type="checkbox" />
                  <div class="toggle-slider"></div>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Hidden metrics elements for compatibility -->
        <div style="display:none;">
          <span id="metricSkirtingLength"></span>
          <span id="metricSkirtingCount"></span>
          <span id="metricSkirtingStripsPerTile"></span>
          <span id="metricSkirtingCost"></span>
          <span id="metricGrandTotalTiles"></span>
          <span id="metricGrandTotalPacks"></span>
          <span id="metricGrandTotalCost"></span>
          <span id="labelSkirtingPieces"></span>
          <span id="stripsPerTileWrap"></span>
          <span id="skirtingMetricsBox"></span>
          <span id="grandTotalBox"></span>
        </div>
      </section>

      <!-- ========== COMMERCIAL TAB ========== -->
      <section class="main-panel" data-main-panel="commercial">
        <div class="commercial-container">
          <div class="section-card">
            <div class="section-header">
              <h3 class="section-title" data-i18n="commercial.rooms">Room Overview</h3>
            </div>
            <div class="card-content">
              <div id="commercialRoomsList" class="commercial-list">
                <!-- Will be populated by render.js -->
              </div>
            </div>
          </div>

          <div class="section-card">
            <div class="section-header">
              <h3 class="section-title" data-i18n="commercial.materials">Consolidated Materials</h3>
            </div>
            <div class="card-content">
              <div id="commercialMaterialsList" class="commercial-list">
                <!-- Will be populated by render.js -->
              </div>
            </div>
          </div>

          <div class="section-card">
            <div class="card-content">
              <button id="btnExportCommercial" class="btn primary" style="width: 100%;">
                <span data-i18n="commercial.export">Export Summary</span>
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- ========== EXPORT TAB ========== -->
      <section class="main-panel" data-main-panel="export">
        <div class="export-container">
          <div class="section-card export-card">
            <div class="section-header">
              <h3 class="section-title" data-i18n="export.roomPlans">Room Plans (PDF)</h3>
            </div>
            <div class="card-content">
              <div class="export-rooms">
                <div class="export-rooms-header">
                  <div class="export-actions">
                    <button id="exportSelectAllRooms" class="btn small" data-i18n="export.selectAll">Select All</button>
                    <button id="exportClearRooms" class="btn small ghost" data-i18n="export.clear">Clear</button>
                  </div>
                </div>
                <div id="exportRoomsList" class="export-rooms-list"></div>
              </div>
            </div>
          </div>

          <div class="section-card export-card">
            <div class="section-header">
              <h3 class="section-title" data-i18n="export.commercial">Commercial Summary</h3>
            </div>
            <div class="card-content">
              <div class="export-options">
                <div class="field-row">
                  <div class="field">
                    <label data-i18n="export.pageSize">Page Size</label>
                    <select id="exportPageSize">
                      <option value="A4">A4</option>
                      <option value="A3">A3</option>
                    </select>
                  </div>
                  <div class="field">
                    <label data-i18n="export.orientation">Orientation</label>
                    <select id="exportOrientation">
                      <option value="portrait" data-i18n="export.portrait">Portrait</option>
                      <option value="landscape" data-i18n="export.landscape">Landscape</option>
                    </select>
                  </div>
                  <div class="field">
                    <label data-i18n="export.scale">Scale</label>
                    <select id="exportScale">
                      <option value="fit" data-i18n="export.fitToPage">Fit to Page</option>
                      <option value="1:20">1:20</option>
                      <option value="1:50">1:50</option>
                      <option value="1:100">1:100</option>
                    </select>
                  </div>
                </div>

                <div class="toggle-grid">
                  <label class="toggle-switch">
                    <span class="toggle-label" data-i18n="export.includeGrid">Include Grid</span>
                    <input id="exportIncludeGrid" type="checkbox" checked />
                    <div class="toggle-slider"></div>
                  </label>
                  <label class="toggle-switch">
                    <span class="toggle-label" data-i18n="export.includeSkirting">Include Skirting</span>
                    <input id="exportIncludeSkirting" type="checkbox" checked />
                    <div class="toggle-slider"></div>
                  </label>
                  <label class="toggle-switch">
                    <span class="toggle-label" data-i18n="export.includeExclusions">Include Exclusions</span>
                    <input id="exportIncludeExclusions" type="checkbox" checked />
                    <div class="toggle-slider"></div>
                  </label>
                  <label class="toggle-switch">
                    <span class="toggle-label" data-i18n="export.includeLegend">Include Legend</span>
                    <input id="exportIncludeLegend" type="checkbox" checked />
                    <div class="toggle-slider"></div>
                  </label>
                  <label class="toggle-switch">
                    <span class="toggle-label" data-i18n="export.includeMetrics">Include Metrics</span>
                    <input id="exportIncludeMetrics" type="checkbox" checked />
                    <div class="toggle-slider"></div>
                  </label>
                </div>

                <div class="field">
                  <label data-i18n="export.notes">Notes</label>
                  <textarea id="exportNotes" rows="3" placeholder=""></textarea>
                </div>

                <div id="exportProgress" class="export-progress hidden">
                  <div class="export-progress-bar">
                    <div id="exportProgressFill" class="export-progress-fill"></div>
                  </div>
                  <div id="exportStatus" class="export-status">–</div>
                </div>

                <div class="export-buttons">
                  <button id="btnExportRoomsPdf" class="btn primary" data-i18n="export.exportRoomsPdf">Room Plans PDF</button>
                  <button id="btnExportCommercialPdf" class="btn" data-i18n="export.exportCommercialPdf">Commercial PDF</button>
                  <button id="btnExportCommercialXlsx" class="btn" data-i18n="export.exportXlsx">Export Excel</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- ==================== MODAL DIALOG ==================== -->
    <div id="dialogOverlay" class="dialog-overlay hidden">
      <div id="dialogModal" class="dialog-modal">
        <div class="dialog-header">
          <h3 id="dialogTitle" class="dialog-title">Dialog Title</h3>
        </div>
        <div class="dialog-content">
          <p id="dialogMessage" class="dialog-message"></p>
          <div id="dialogInputSection" class="dialog-input-section hidden">
            <input id="dialogInput" type="text" class="dialog-input" />
          </div>
          <div id="dialogSelectSection" class="dialog-select-section hidden">
            <select id="dialogSelect" class="dialog-select"></select>
          </div>
        </div>
        <div class="dialog-actions">
          <button id="dialogCancelBtn" class="btn ghost small">Cancel</button>
          <button id="dialogConfirmBtn" class="btn primary small">Confirm</button>
        </div>
      </div>
    </div>

    <!-- ==================== DEBUG ==================== -->
    <div id="warningsPanel" class="debug-panel warnings-panel hidden">
      <div class="debug-panel-header">
        <h4 class="debug-panel-title" data-i18n="warnings.title">Warnings</h4>
        <button id="btnCloseWarnings" class="btn-icon small" title="Close">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="debug-panel-content">
        <div id="warningsList" class="warnings"></div>
      </div>
    </div>
    <div id="tipsPanel" class="debug-panel warnings-panel hidden">
      <div class="debug-panel-header">
        <h4 class="debug-panel-title" data-i18n="warnings.tipsTitle">Tips</h4>
        <button id="btnCloseTips" class="btn-icon small" title="Close">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="debug-panel-content">
        <div id="tipsList" class="warnings"></div>
      </div>
    </div>

    <div id="debugPanel" class="debug-panel hidden">
      <div class="debug-panel-header">
        <h4 class="debug-panel-title" data-i18n="debug.title">Debug</h4>
        <button id="btnCloseDebug" class="btn-icon small" title="Close">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="debug-panel-content">
        <div class="field">
          <label class="toggle-switch">
            <span class="toggle-label" data-i18n="debug.showNeeds">Show Offcut Needs</span>
            <input id="debugShowNeeds" type="checkbox" />
            <div class="toggle-slider"></div>
          </label>
        </div>
        <button id="btnCopy" class="btn small" data-i18n="importExport.copy">Copy State</button>
        <pre id="stateView" class="code">–</pre>
      </div>
    </div>

    <script>
      function toggleCard(header) {
        const card = header.closest('.section-card');
        const content = card.querySelector('.card-content');
        const toggle = header.querySelector('.collapse-toggle');
        const isHidden = content.classList.toggle('hidden');
        if (toggle) {
          toggle.style.transform = isHidden ? 'rotate(0deg)' : 'rotate(180deg)';
        }
      }
    </script>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
