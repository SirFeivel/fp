<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TilePerfect [ALPHA]</title>
  </head>
  <body>
    <!-- ==================== HEADER ==================== -->
    <header class="topbar">
      <div class="topbar-left">
        <img src="/logo.svg" alt="TilePerfect Logo" class="logo" />
        <div class="topbar-title">
          <div class="title" data-i18n="app.title">TilePerfect [ALPHA]</div>
        </div>
      </div>
      <div class="topbar-right">
        <div class="undo-controls">
          <button id="btnUndo" class="btn-icon" title="Undo (Ctrl+Z)" data-i18n-title="undo.undo">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 7v6h6"/>
              <path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"/>
            </svg>
          </button>
          <button id="btnRedo" class="btn-icon" title="Redo (Ctrl+Y)" data-i18n-title="undo.redo">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 7v6h-6"/>
              <path d="M3 17a9 9 0 019-9 9 9 0 016 2.3l3 2.7"/>
            </svg>
          </button>
          <span class="undo-counter" id="undoCounter">0 / 0</span>
        </div>
        <div class="lang-picker">
          <select id="langSelect">
            <option value="de" data-i18n="language.german">Deutsch</option>
            <option value="en" data-i18n="language.english">English</option>
          </select>
        </div>
        <div class="autosave-indicator">
          <span class="dot"></span>
          <span data-i18n="app.autosave">Autosave</span>
        </div>
        <div class="settings-menu">
          <button id="btnSettingsToggle" class="btn-icon" title="Settings">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </button>
          <div id="settingsDropdown" class="settings-dropdown hidden">
            <div class="settings-section">
              <button id="menuSaveProject" class="settings-item">
                <span class="settings-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                    <polyline points="7 3 7 8 15 8"></polyline>
                  </svg>
                </span>
                <span data-i18n="settings.save">Save Project</span>
              </button>
              <button id="menuLoadProject" class="settings-item">
                <span class="settings-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 7h5l2 2h11v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <path d="M3 7V5a2 2 0 0 1 2-2h4l2 2"></path>
                  </svg>
                </span>
                <span data-i18n="settings.load">Load Project</span>
              </button>
            </div>
            <div class="settings-divider"></div>
            <div class="settings-section">
              <button id="menuExport" class="settings-item">
                <span class="settings-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 3h7v7"></path>
                    <path d="M10 14L21 3"></path>
                    <path d="M21 14v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h7"></path>
                  </svg>
                </span>
                <span data-i18n="settings.export">Export JSON</span>
              </button>
              <button id="menuImport" class="settings-item">
                <span class="settings-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                </span>
                <span data-i18n="settings.import">Import JSON</span>
              </button>
            </div>
            <div class="settings-divider"></div>
            <div class="settings-section">
              <button id="menuDebug" class="settings-item">
                <span class="settings-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 9a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"></path>
                    <path d="M19 12a7 7 0 0 0-14 0"></path>
                    <path d="M5 12v2"></path>
                    <path d="M19 12v2"></path>
                    <path d="M12 2v3"></path>
                    <path d="M3 12H2"></path>
                    <path d="M22 12h-1"></path>
                  </svg>
                </span>
                <span data-i18n="settings.debug">Debug Panel</span>
              </button>
              <button id="menuReset" class="settings-item danger">
                <span class="settings-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 2v6h-6"></path>
                    <path d="M3 12a9 9 0 0 1 15-6l3 2"></path>
                    <path d="M3 22v-6h6"></path>
                    <path d="M21 12a9 9 0 0 1-15 6l-3-2"></path>
                  </svg>
                </span>
                <span data-i18n="settings.reset">Reset All</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- ==================== MAIN NAVIGATION ==================== -->
    <nav class="main-nav">
      <div class="main-nav-tabs">
        <button class="main-nav-tab active" data-main-tab="setup">
          <span class="main-nav-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 10.5l9-7 9 7"></path>
              <path d="M5 9.5V21h14V9.5"></path>
              <path d="M9 21v-6h6v6"></path>
            </svg>
          </span>
          <span data-i18n="nav.setup">Setup</span>
        </button>
        <button class="main-nav-tab" data-main-tab="planning">
          <span class="main-nav-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="6" width="18" height="12" rx="2"></rect>
              <line x1="7" y1="6" x2="7" y2="10"></line>
              <line x1="11" y1="6" x2="11" y2="12"></line>
              <line x1="15" y1="6" x2="15" y2="10"></line>
              <line x1="19" y1="6" x2="19" y2="12"></line>
            </svg>
          </span>
          <span data-i18n="nav.planning">Planning</span>
        </button>
        <button class="main-nav-tab" data-main-tab="commercial">
          <span class="main-nav-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 1v22"></path>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
          </span>
          <span data-i18n="nav.commercial">Commercial</span>
        </button>
      </div>
      <div class="main-nav-context">
        <span id="navContextInfo" class="nav-context-text"></span>
      </div>
      <div class="main-nav-actions">
        <div id="warningsWrapper" class="planning-warnings-mini">
          <span class="warn-icon" aria-hidden="true">!</span>
          <span class="pill" id="warnPill">0</span>
        </div>
        <div id="tipsWrapper" class="planning-warnings-mini planning-tips-mini hidden">
          <span class="warn-icon" aria-hidden="true">i</span>
          <span class="pill" id="tipsPill">0</span>
        </div>
      </div>
    </nav>

    <!-- ==================== MAIN CONTENT ==================== -->
    <main class="main-content">

      <!-- ========== SETUP TAB ========== -->
      <section class="main-panel active" data-main-panel="setup">
        <div class="setup-flow">
          <!-- Floor Section -->
          <div class="setup-block">
            <div class="setup-block-header">
              <span class="setup-block-number">1</span>
              <h3 class="setup-block-title" data-i18n="setup.floorTitle">Floor</h3>
            </div>
            <div class="setup-block-content">
              <div class="inline-select-row">
                <select id="floorSelect" class="inline-select"></select>
                <button id="btnAddFloor" class="btn-inline" title="Add Floor">+</button>
                <button id="btnDeleteFloor" class="btn-inline danger" title="Delete Floor">√ó</button>
              </div>
              <div class="field">
                <label data-i18n="tabs.floorName">Name</label>
                <input id="floorName" type="text" placeholder="e.g. Ground Floor" />
              </div>
            </div>
          </div>

          <!-- Room Section -->
          <div class="setup-block">
            <div class="setup-block-header">
              <span class="setup-block-number">2</span>
              <h3 class="setup-block-title" data-i18n="setup.roomTitle">Room</h3>
            </div>
            <div class="setup-block-content">
              <div class="inline-select-row">
                <select id="roomSelect" class="inline-select"></select>
                <button id="btnAddRoom" class="btn-inline" title="Add Room">+</button>
                <button id="btnDeleteRoom" class="btn-inline danger" title="Delete Room">√ó</button>
              </div>
              <div class="field">
                <label data-i18n="room.name">Name</label>
                <input id="roomName" type="text" placeholder="e.g. Bathroom" />
              </div>

              <div class="dimensions-row">
                <div class="field">
                  <label data-i18n="setup.width">Width (cm)</label>
                  <input id="roomWidth" type="number" min="1" step="1" placeholder="300" />
                </div>
                <span class="dimensions-x">√ó</span>
                <div class="field">
                  <label data-i18n="setup.length">Length (cm)</label>
                  <input id="roomLength" type="number" min="1" step="1" placeholder="400" />
                </div>
              </div>
              <label class="toggle-switch">
                <span class="toggle-label" data-i18n="skirting.roomEnabled">Skirting for this room</span>
                <input id="roomSkirtingEnabled" type="checkbox" />
                <div class="toggle-slider"></div>
              </label>

              <!-- Advanced: Multiple Sections -->
              <div id="sectionsAdvanced" class="sections-advanced">
                <div class="sections-hint" id="sectionsHint">
                  <span class="hint-icon">üí°</span>
                  <span data-i18n="setup.complexRoomHint">Need an L-shape or complex room?</span>
                  <button id="btnAddSection" class="btn-text" data-i18n="room.addSection">+ Add Section</button>
                </div>

                <div id="sectionsPanel" class="sections-panel hidden">
                  <div class="sections-header">
                    <label data-i18n="room.sectionsList">Sections</label>
                    <button id="btnAddSectionAlt" class="btn-inline small" title="Add Section">+</button>
                  </div>
                  <div class="inline-select-row">
                    <select id="sectionsList" class="inline-select"></select>
                    <button id="btnDeleteSection" class="btn-inline danger small" title="Delete Section">√ó</button>
                  </div>
                  <div id="sectionProps" class="section-props-grid">
                    <!-- Populated dynamically -->
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tile Collection -->
          <div class="setup-block">
            <div class="setup-block-header">
              <span class="setup-block-number">3</span>
              <h3 class="setup-block-title" data-i18n="setup.tileCollection">Tile Collection</h3>
            </div>
            <div class="setup-block-content">
              <div class="setup-collection">
                <div class="collection-section">
                  <h4 class="collection-title" data-i18n="setup.tilePresets">Tile Presets</h4>
                  <div class="inline-select-row">
                    <select id="tilePresetList" class="inline-select"></select>
                    <button id="btnAddTilePreset" class="btn-inline" title="Add Preset">+</button>
                    <button id="btnDeleteTilePreset" class="btn-inline danger" title="Delete Preset">√ó</button>
                  </div>
                  <div class="field">
                    <label data-i18n="setup.presetName">Name</label>
                    <input id="tilePresetName" type="text" />
                  </div>
                  <div class="field">
                    <label data-i18n="tile.shape">Tile Shape</label>
                    <select id="tilePresetShape">
                      <option value="rect" data-i18n="tile.shapeRect">Rectangular</option>
                      <option value="square" data-i18n="tile.shapeSquare">Square</option>
                      <option value="hex" data-i18n="tile.shapeHex">Hexagonal</option>
                      <option value="rhombus" data-i18n="tile.shapeRhombus">Rhombus</option>
                    </select>
                  </div>
                  <div class="field-row">
                    <div class="field">
                      <label data-i18n="tile.width">Width (cm)</label>
                      <input id="tilePresetW" type="number" min="0" step="0.1" />
                    </div>
                    <div class="field">
                      <label data-i18n="tile.height">Length (cm)</label>
                      <input id="tilePresetH" type="number" min="0" step="0.1" />
                    </div>
                  </div>
                  <div class="field-row">
                    <div class="field">
                      <label data-i18n="tile.grout">Grout</label>
                      <div class="input-with-unit">
                        <div class="quick-spinner">
                          <button type="button" class="quick-spinner-btn" data-action="decrement" data-target="tilePresetGroutW">‚àí</button>
                          <input id="tilePresetGroutW" type="number" class="quick-input small no-spinner" min="0" step="1" />
                          <button type="button" class="quick-spinner-btn" data-action="increment" data-target="tilePresetGroutW">+</button>
                        </div>
                        <span class="input-unit">mm</span>
                      </div>
                    </div>
                    <div class="field">
                      <label data-i18n="tile.groutColor">Color</label>
                      <div class="color-picker-row">
                        <div class="color-presets" id="tilePresetGroutColorPresets">
                          <button type="button" class="color-swatch" data-color="#ffffff" style="background:#ffffff" title="White"></button>
                          <button type="button" class="color-swatch" data-color="#cccccc" style="background:#cccccc" title="Light Grey"></button>
                          <button type="button" class="color-swatch" data-color="#808080" style="background:#808080" title="Grey"></button>
                          <button type="button" class="color-swatch" data-color="#404040" style="background:#404040" title="Dark Grey"></button>
                          <button type="button" class="color-swatch" data-color="#000000" style="background:#000000" title="Black"></button>
                        </div>
                        <input id="tilePresetGroutColor" type="color" value="#ffffff" />
                      </div>
                    </div>
                  </div>
                  <div class="field-row">
                    <div class="field">
                      <label data-i18n="pricing.pricePerM2">Price per m¬≤ (‚Ç¨)</label>
                      <input id="tilePresetPricePerM2" type="number" min="0" step="0.01" />
                    </div>
                    <div class="field">
                      <label data-i18n="pricing.packSize">Pack size (m¬≤)</label>
                      <input id="tilePresetPackM2" type="number" min="0" step="0.01" />
                    </div>
                  </div>
                  <div class="field">
                    <label data-i18n="pricing.pricePerPack">Price per pack (‚Ç¨)</label>
                    <input id="tilePresetPricePerPack" type="number" min="0" step="0.01" />
                  </div>
                  <div class="field">
                    <label data-i18n="setup.assignRooms">Assign to rooms</label>
                    <div id="tilePresetRoomList" class="preset-room-list"></div>
                  </div>
                  <label class="toggle-switch">
                    <span class="toggle-label" data-i18n="setup.useForSkirting">Use as skirting (cutout)</span>
                    <input id="tilePresetUseSkirting" type="checkbox" />
                    <div class="toggle-slider"></div>
                  </label>
                </div>

                <div class="collection-section">
                  <h4 class="collection-title" data-i18n="setup.skirtingPresets">Skirting Presets</h4>
                  <div class="inline-select-row">
                    <select id="skirtingPresetList" class="inline-select"></select>
                    <button id="btnAddSkirtingPreset" class="btn-inline" title="Add Preset">+</button>
                    <button id="btnDeleteSkirtingPreset" class="btn-inline danger" title="Delete Preset">√ó</button>
                  </div>
                  <div class="field">
                    <label data-i18n="setup.presetName">Name</label>
                    <input id="skirtingPresetName" type="text" />
                  </div>
                  <div class="field-row">
                    <div class="field">
                      <label data-i18n="skirting.height">Height (cm)</label>
                      <input id="skirtingPresetHeight" type="number" min="0" step="0.1" />
                    </div>
                    <div class="field">
                      <label data-i18n="skirting.boughtWidth">Length/piece (cm)</label>
                      <input id="skirtingPresetLength" type="number" min="0" step="0.1" />
                    </div>
                  </div>
                  <div class="field">
                    <label data-i18n="skirting.pricePerPiece">Price/piece (‚Ç¨)</label>
                    <input id="skirtingPresetPrice" type="number" min="0" step="0.01" />
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Continue Button -->
          <div class="setup-continue">
            <button id="btnContinuePlanning" class="btn primary large">
              <span data-i18n="setup.continuePlanning">Continue to Planning</span>
              <span class="btn-arrow">‚Üí</span>
            </button>
          </div>
        </div>

        <!-- Hidden elements for compatibility -->
        <input id="fileImport" type="file" accept="application/json" style="display: none;" />
        <input id="projectName" type="hidden" />
        <select id="projectSelect" style="display: none;"></select>
        <span id="sessionStatus" style="display: none;"></span>
        <span id="lastSaved" style="display: none;"></span>
      </section>

      <!-- ========== PLANNING TAB ========== -->
      <section class="main-panel" data-main-panel="planning">
        <div class="planning-fullwidth">
          <!-- Planning Header -->
          <div class="planning-header">
            <div class="planning-header-left">
              <label class="planning-room-select">
                <span data-i18n="tabs.floor">Floor:</span>
                <select id="planningFloorSelect"></select>
              </label>
              <label class="planning-room-select">
                <span data-i18n="tabs.room">Room:</span>
                <select id="planningRoomSelect"></select>
              </label>
              <span class="planning-area" id="planningArea">‚Äì</span>
            </div>
            <div class="planning-header-right">
              <button id="btnFullscreen" class="btn-icon" title="Fullscreen">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
                </svg>
              </button>
            </div>
          </div>

          <!-- SVG Preview Area -->
          <div class="planning-preview-area">
            <div class="svgWrap planning-svg">
              <svg id="planSvg" xmlns="http://www.w3.org/2000/svg"></svg>
              <div id="resizeMetrics" class="resize-metrics hidden"></div>

              <!-- Quick Controls Bar (floating) -->
              <div class="quick-controls">
                <div class="quick-control-group">
                  <span class="quick-label" data-i18n="planning.tile">Tile:</span>
                  <select id="quickTilePreset" class="quick-select quick-select-wide"></select>
                </div>
                <div class="quick-control-group">
                  <span class="quick-label" data-i18n="tile.pattern">Pattern:</span>
                  <select id="quickPattern" class="quick-select">
                    <option value="grid">Grid</option>
                    <option value="runningBond">Running Bond</option>
                    <option value="herringbone">Herringbone</option>
                    <option value="doubleHerringbone">Double Herringbone</option>
                    <option value="basketweave">Basketweave</option>
                  </select>
                </div>
                <div class="quick-control-group">
                  <span class="quick-label" data-i18n="tile.grout">Grout:</span>
                  <div class="quick-spinner">
                    <button type="button" class="quick-spinner-btn" data-action="decrement" data-target="quickGrout">‚àí</button>
                    <input id="quickGrout" type="number" class="quick-input small no-spinner" min="0" step="1" />
                    <button type="button" class="quick-spinner-btn" data-action="increment" data-target="quickGrout">+</button>
                  </div>
                  <span class="quick-unit">mm</span>
                </div>
                <div class="quick-control-divider"></div>
                <div class="quick-toggles">
                  <label class="quick-toggle" title="Show Grid">
                    <input id="quickShowGrid" type="checkbox" />
                    <span class="quick-toggle-icon">‚ñ¶</span>
                  </label>
                  <label class="quick-toggle" title="Show Skirting">
                    <input id="quickShowSkirting" type="checkbox" />
                    <span class="quick-toggle-icon">‚ñ≠</span>
                  </label>
                  <label class="quick-toggle" title="Removal Mode">
                    <input id="quickRemovalMode" type="checkbox" />
                    <span class="quick-toggle-icon">‚úÇ</span>
                  </label>
                </div>
                <div class="quick-control-divider"></div>
                <div class="quick-actions">
                  <div class="quick-dropdown">
                    <button id="quickAddExclusion" class="quick-btn" title="Add Exclusion">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                        <line x1="12" y1="8" x2="12" y2="16"></line>
                        <line x1="8" y1="12" x2="16" y2="12"></line>
                      </svg>
                    </button>
                    <div id="exclDropdown" class="quick-dropdown-menu hidden">
                      <button class="quick-dropdown-item" data-excl-type="rect">
                        <span class="quick-dropdown-icon">‚ñ≠</span>
                        <span>Rectangle</span>
                      </button>
                      <button class="quick-dropdown-item" data-excl-type="circle">
                        <span class="quick-dropdown-icon">‚óã</span>
                        <span>Circle</span>
                      </button>
                      <button class="quick-dropdown-item" data-excl-type="triangle">
                        <span class="quick-dropdown-icon">‚ñ≥</span>
                        <span>Triangle</span>
                      </button>
                    </div>
                  </div>
                  <button id="quickOpenSettings" class="quick-btn" title="Settings">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="3"></circle>
                      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Metrics Bar -->
          <div class="metrics-bar" id="metrics">
            <div class="metrics-bar-item">
              <span class="metrics-bar-label" data-i18n="metrics.netArea">Area:</span>
              <span class="metrics-bar-value" id="metricArea">‚Äì</span>
            </div>
            <div class="metrics-bar-divider"></div>
            <div class="metrics-bar-item">
              <span class="metrics-bar-label" data-i18n="metrics.totalTiles">Tiles:</span>
              <span class="metrics-bar-value" id="metricTiles">‚Äì</span>
              <span class="metrics-bar-sub">(<span id="metricCutTiles">‚Äì</span> cut)</span>
            </div>
            <div class="metrics-bar-divider"></div>
            <div class="metrics-bar-item">
              <span class="metrics-bar-label" data-i18n="metrics.tilePacks">Packs:</span>
              <span class="metrics-bar-value" id="metricPacks">‚Äì</span>
            </div>
            <div class="metrics-bar-divider"></div>
            <div class="metrics-bar-item highlight">
              <span class="metrics-bar-label" data-i18n="metrics.price">Cost:</span>
              <span class="metrics-bar-value" id="metricCost">‚Äì</span>
            </div>
            <div class="metrics-bar-divider"></div>
            <div class="metrics-bar-item">
              <span class="metrics-bar-label" data-i18n="metrics.waste">Waste:</span>
              <span class="metrics-bar-value" id="metricWaste">‚Äì</span>
            </div>
          </div>
        </div>

        <!-- Slide-out Settings Panel -->
        <div id="settingsPanel" class="settings-panel hidden">
          <div class="settings-panel-header">
            <h3 data-i18n="planning.settings">Settings</h3>
            <button id="btnCloseSettings" class="btn-icon small">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <div class="settings-panel-content">
            <!-- Tile Settings -->
            <div class="panel-section">
              <h4 class="panel-section-title" data-i18n="tile.sectionTiles">Tiles</h4>
              <div class="panel-fields">
                <div class="field-row">
                  <div class="field">
                    <label data-i18n="tile.preset">Preset</label>
                    <select id="tilePresetSelect"></select>
                  </div>
                  <div class="field">
                    <label>&nbsp;</label>
                    <button id="btnApplyTilePreset" class="btn small" data-i18n="tile.applyPreset">Apply Preset</button>
                  </div>
                </div>
                <label class="toggle-switch">
                  <span class="toggle-label" data-i18n="planning.editTileConfig">Edit</span>
                  <input id="tileConfigEditToggle" type="checkbox" />
                  <div class="toggle-slider"></div>
                </label>
                <div id="tileEditActions" class="tile-edit-actions hidden">
                  <div class="tile-edit-actions-text" data-i18n="planning.tileEditActionsTitle">Save changes</div>
                  <div class="tile-edit-actions-buttons">
                    <button id="tileEditUpdateBtn" class="btn small" data-i18n="planning.tileEditUpdatePreset">Update preset</button>
                    <button id="tileEditNewBtn" class="btn small" data-i18n="planning.tileEditSaveNew">Save new</button>
                    <button id="tileEditDiscardBtn" class="btn ghost small" data-i18n="planning.tileEditDiscard">Discard</button>
                  </div>
                </div>
                <div class="tile-config-fields">
                <div class="field">
                  <label data-i18n="tile.reference">Reference / Name</label>
                  <input id="tileReference" type="text" list="tileReferences" placeholder="e.g. Marble Carrara" />
                  <datalist id="tileReferences"></datalist>
                  <div id="tileEditError" class="field-error hidden"></div>
                </div>
                <div class="field">
                  <label data-i18n="tile.shape">Tile Shape</label>
                  <select id="tileShape">
                    <option value="rect" data-i18n="tile.shapeRect">Rectangular</option>
                    <option value="square" data-i18n="tile.shapeSquare">Square</option>
                    <option value="hex" data-i18n="tile.shapeHex">Hexagonal</option>
                    <option value="rhombus" data-i18n="tile.shapeRhombus">Rhombus</option>
                  </select>
                </div>
                <div class="field-row">
                  <div class="field">
                    <label data-i18n="tile.width">Width (cm)</label>
                    <input id="tileW" type="number" min="0" step="0.1" />
                  </div>
                  <div class="field" id="tileHeightField">
                    <label data-i18n="tile.height">Length (cm)</label>
                    <input id="tileH" type="number" min="0" step="0.1" />
                  </div>
                </div>
                <div class="meta subtle" id="hexHint" style="display: none;">
                  <span data-i18n="tile.hexHint">For hexagons: width = flat-to-flat. Height auto-calculated.</span>
                </div>
                <div class="field-row">
                  <div class="field">
                    <label data-i18n="pricing.pricePerM2">Price per m¬≤ (‚Ç¨)</label>
                    <input id="tilePricePerM2" type="number" min="0" step="0.01" />
                  </div>
                  <div class="field">
                    <label data-i18n="pricing.packSize">Pack size (m¬≤)</label>
                    <input id="tilePackM2" type="number" min="0" step="0.01" />
                  </div>
                </div>
                <div class="field">
                  <label data-i18n="pricing.pricePerPack">Price per pack (‚Ç¨)</label>
                  <input id="tilePricePerPack" type="number" min="0" step="0.01" disabled />
                </div>
                <label class="toggle-switch">
                  <span class="toggle-label" data-i18n="setup.useForSkirting">Use as skirting (cutout)</span>
                  <input id="tileAllowSkirting" type="checkbox" />
                  <div class="toggle-slider"></div>
                </label>
                </div>
              </div>
            </div>

            <!-- Grout Settings -->
            <div class="panel-section">
              <h4 class="panel-section-title" data-i18n="tile.sectionGrout">Grout</h4>
              <div class="panel-fields">
                <div class="field-row">
                  <div class="field">
                    <label data-i18n="tile.grout">Grout</label>
                    <div class="input-with-unit">
                      <div class="quick-spinner">
                        <button type="button" class="quick-spinner-btn" data-action="decrement" data-target="groutW">‚àí</button>
                        <input id="groutW" type="number" class="quick-input small no-spinner" min="0" step="1" />
                        <button type="button" class="quick-spinner-btn" data-action="increment" data-target="groutW">+</button>
                      </div>
                      <span class="input-unit">mm</span>
                    </div>
                  </div>
                  <div class="field">
                    <label data-i18n="tile.groutColor">Color</label>
                    <div class="color-picker-row">
                      <div class="color-presets" id="groutColorPresets">
                        <button type="button" class="color-swatch" data-color="#ffffff" style="background:#ffffff" title="White"></button>
                        <button type="button" class="color-swatch" data-color="#cccccc" style="background:#cccccc" title="Light Grey"></button>
                        <button type="button" class="color-swatch" data-color="#808080" style="background:#808080" title="Grey"></button>
                        <button type="button" class="color-swatch" data-color="#404040" style="background:#404040" title="Dark Grey"></button>
                        <button type="button" class="color-swatch" data-color="#000000" style="background:#000000" title="Black"></button>
                      </div>
                      <input id="groutColor" type="color" value="#ffffff" />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Pattern Settings -->
            <div class="panel-section">
              <h4 class="panel-section-title" data-i18n="tile.sectionLayout">Pattern & Layout</h4>
              <div class="panel-fields">
                <div class="field-row">
                  <div class="field">
                    <label data-i18n="tile.pattern">Pattern</label>
                    <select id="patternType">
                      <option value="grid" data-i18n="tile.patternGrid">Grid</option>
                      <option value="runningBond" data-i18n="tile.patternRunningBond">Running Bond</option>
                      <option value="herringbone" data-i18n="tile.patternHerringbone">Herringbone</option>
                      <option value="doubleHerringbone" data-i18n="tile.patternDoubleHerringbone">Double Herringbone</option>
                      <option value="basketweave" data-i18n="tile.patternBasketweave">Basketweave</option>
                      <option value="verticalStackAlternating" data-i18n="tile.patternVerticalStackAlternating">Vertical Stack Alt.</option>
                    </select>
                  </div>
                  <div class="field">
                    <label data-i18n="tile.rotation">Rotation</label>
                    <select id="rotationDeg">
                      <option value="0">0¬∞</option>
                      <option value="45">45¬∞</option>
                      <option value="90">90¬∞</option>
                      <option value="135">135¬∞</option>
                      <option value="180">180¬∞</option>
                      <option value="225">225¬∞</option>
                      <option value="270">270¬∞</option>
                      <option value="315">315¬∞</option>
                    </select>
                  </div>
                </div>
                <div class="field">
                  <label data-i18n="tile.bondFraction">Bond Fraction</label>
                  <select id="bondFraction">
                    <option value="0.5">1/2</option>
                    <option value="0.3333333333">1/3</option>
                    <option value="0.25">1/4</option>
                  </select>
                </div>

                <!-- Advanced: Origin & Offset -->
                <details class="panel-details">
                  <summary data-i18n="planning.advanced">Advanced (Origin & Offset)</summary>
                  <div class="panel-fields">
                    <div class="field">
                      <label data-i18n="origin.preset">Origin Preset</label>
                      <select id="originPreset">
                        <option value="tl" data-i18n="origin.presetTL">Top Left</option>
                        <option value="tr" data-i18n="origin.presetTR">Top Right</option>
                        <option value="bl" data-i18n="origin.presetBL">Bottom Left</option>
                        <option value="br" data-i18n="origin.presetBR">Bottom Right</option>
                        <option value="center" data-i18n="origin.presetCenter">Center</option>
                        <option value="free" data-i18n="origin.presetFree">Free</option>
                      </select>
                    </div>
                    <div class="field-row">
                      <div class="field">
                        <label data-i18n="origin.x">Origin X</label>
                        <input id="originX" type="number" step="1" />
                      </div>
                      <div class="field">
                        <label data-i18n="origin.y">Origin Y</label>
                        <input id="originY" type="number" step="1" />
                      </div>
                    </div>
                    <div class="field-row">
                      <div class="field">
                        <label data-i18n="tile.offsetX">Offset X</label>
                        <input id="offsetX" type="number" step="1" />
                      </div>
                      <div class="field">
                        <label data-i18n="tile.offsetY">Offset Y</label>
                        <input id="offsetY" type="number" step="1" />
                      </div>
                    </div>
                    <div class="btnrow">
                      <button id="btnOffLeft" class="btn small">‚Üê</button>
                      <button id="btnOffRight" class="btn small">‚Üí</button>
                      <button id="btnOffUp" class="btn small">‚Üë</button>
                      <button id="btnOffDown" class="btn small">‚Üì</button>
                    </div>
                  </div>
                </details>
              </div>
            </div>

            <!-- Skirting -->
            <div class="panel-section">
              <h4 class="panel-section-title" data-i18n="skirting.title">Skirting</h4>
              <div class="panel-fields" id="skirtingRoomsList">
                <div class="meta subtle" data-i18n="project.none">‚Äì none ‚Äì</div>
              </div>
            </div>

            <!-- Exclusions -->
            <div class="panel-section">
              <h4 class="panel-section-title" data-i18n="exclusions.title">Exclusions</h4>
              <div class="panel-fields">
                <div class="btnrow">
                  <button id="btnAddRect" class="btn small">+ Rect</button>
                  <button id="btnAddCircle" class="btn small">+ Circle</button>
                  <button id="btnAddTri" class="btn small">+ Tri</button>
                </div>
                <div class="field">
                  <select id="exclList" size="3" class="excl-list"></select>
                </div>
                <div class="btnrow">
                  <button id="btnDeleteExcl" class="btn small danger" data-i18n="exclusions.delete">Delete</button>
                </div>
                <div id="exclProps" class="excl-props">
                  <div class="meta subtle" data-i18n="exclusions.noneSelected">‚Äì none selected ‚Äì</div>
                </div>
              </div>
            </div>

            <!-- Calculation Options -->
            <div class="panel-section">
              <h4 class="panel-section-title" data-i18n="tile.sectionPricing">Calculation</h4>
              <div class="panel-fields">
                <div class="field-row">
                  <div class="field">
                    <label data-i18n="pricing.reserve">Reserve (tiles)</label>
                    <input id="reserveTiles" type="number" step="1" min="0" />
                  </div>
                  <div class="field">
                    <label data-i18n="waste.kerfWidth">Kerf (cm)</label>
                    <input id="wasteKerfCm" type="number" min="0" step="0.1" value="0" />
                  </div>
                </div>
                <label class="toggle-switch">
                  <span class="toggle-label" data-i18n="waste.allowRotate">Allow offcut rotation</span>
                  <input id="wasteAllowRotate" type="checkbox" checked />
                  <div class="toggle-slider"></div>
                </label>
                <label class="toggle-switch">
                  <span class="toggle-label" data-i18n="waste.optimizeCuts">Optimize cuts</span>
                  <input id="wasteOptimizeCuts" type="checkbox" />
                  <div class="toggle-slider"></div>
                </label>
              </div>
            </div>

            <!-- Display Options -->
            <div class="panel-section">
              <h4 class="panel-section-title" data-i18n="planning.displayOptions">Display Options</h4>
              <div class="panel-fields">
                <label class="toggle-switch">
                  <span class="toggle-label" data-i18n="planning.showGrid">Show grid lines</span>
                  <input id="showGrid" type="checkbox" />
                  <div class="toggle-slider"></div>
                </label>
                <label class="toggle-switch">
                  <span class="toggle-label" data-i18n="planning.showSkirting">Show skirting</span>
                  <input id="showSkirting" type="checkbox" />
                  <div class="toggle-slider"></div>
                </label>
                <label class="toggle-switch">
                  <span class="toggle-label" data-i18n="planning.removalMode">Removal mode</span>
                  <input id="removalMode" type="checkbox" />
                  <div class="toggle-slider"></div>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Hidden metrics elements for compatibility -->
        <div style="display:none;">
          <span id="metricSkirtingLength"></span>
          <span id="metricSkirtingCount"></span>
          <span id="metricSkirtingStripsPerTile"></span>
          <span id="metricSkirtingCost"></span>
          <span id="metricGrandTotalTiles"></span>
          <span id="metricGrandTotalPacks"></span>
          <span id="metricGrandTotalCost"></span>
          <span id="labelSkirtingPieces"></span>
          <span id="stripsPerTileWrap"></span>
          <span id="skirtingMetricsBox"></span>
          <span id="grandTotalBox"></span>
        </div>
      </section>

      <!-- ========== COMMERCIAL TAB ========== -->
      <section class="main-panel" data-main-panel="commercial">
        <div class="commercial-container">
          <div class="section-card">
            <div class="section-header">
              <h3 class="section-title" data-i18n="commercial.rooms">Room Overview</h3>
            </div>
            <div class="card-content">
              <div id="commercialRoomsList" class="commercial-list">
                <!-- Will be populated by render.js -->
              </div>
            </div>
          </div>

          <div class="section-card">
            <div class="section-header">
              <h3 class="section-title" data-i18n="commercial.materials">Consolidated Materials</h3>
            </div>
            <div class="card-content">
              <div id="commercialMaterialsList" class="commercial-list">
                <!-- Will be populated by render.js -->
              </div>
            </div>
          </div>

          <div class="section-card">
            <div class="card-content">
              <button id="btnExportCommercial" class="btn primary" style="width: 100%;">
                <span data-i18n="commercial.export">Export Summary</span>
              </button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- ==================== DEBUG ==================== -->
    <div id="warningsPanel" class="debug-panel warnings-panel hidden">
      <div class="debug-panel-header">
        <h4 class="debug-panel-title" data-i18n="warnings.title">Warnings</h4>
        <button id="btnCloseWarnings" class="btn-icon small" title="Close">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="debug-panel-content">
        <div id="warningsList" class="warnings"></div>
      </div>
    </div>
    <div id="tipsPanel" class="debug-panel warnings-panel hidden">
      <div class="debug-panel-header">
        <h4 class="debug-panel-title" data-i18n="warnings.tipsTitle">Tips</h4>
        <button id="btnCloseTips" class="btn-icon small" title="Close">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="debug-panel-content">
        <div id="tipsList" class="warnings"></div>
      </div>
    </div>

    <div id="debugPanel" class="debug-panel hidden">
      <div class="debug-panel-header">
        <h4 class="debug-panel-title" data-i18n="debug.title">Debug</h4>
        <button id="btnCloseDebug" class="btn-icon small" title="Close">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="debug-panel-content">
        <div class="field">
          <label class="toggle-switch">
            <span class="toggle-label" data-i18n="debug.showNeeds">Show Offcut Needs</span>
            <input id="debugShowNeeds" type="checkbox" />
            <div class="toggle-slider"></div>
          </label>
        </div>
        <button id="btnCopy" class="btn small" data-i18n="importExport.copy">Copy State</button>
        <pre id="stateView" class="code">‚Äì</pre>
      </div>
    </div>

    <script>
      function toggleCard(header) {
        const card = header.closest('.section-card');
        const content = card.querySelector('.card-content');
        const toggle = header.querySelector('.collapse-toggle');
        const isHidden = content.classList.toggle('hidden');
        if (toggle) {
          toggle.style.transform = isHidden ? 'rotate(0deg)' : 'rotate(180deg)';
        }
      }
    </script>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
